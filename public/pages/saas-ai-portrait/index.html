<!DOCTYPE html>
<html lang="ja">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Portrait Generator - SaaS Applications</title>
  <meta name="description" content="">
  
  <link rel="stylesheet" href="/css/main.css">
  
  
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ 
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        darkMode: true,
        primaryColor: '#4a9eff',
        primaryTextColor: '#ffffff',
        primaryBorderColor: '#2a2a2a',
        lineColor: '#ffffff',
        textColor: '#ffffff',
        taskTextColor: '#ffffff',
        taskTextLightColor: '#ffffff',
        taskFillColor: '#4a9eff',
        taskBorderColor: '#93c5fd',
        activeTaskBorderColor: '#93c5fd',
        activeTaskColor: '#4a9eff',
        doneTaskColor: '#4a9eff',
        doneTaskBorderColor: '#93c5fd',
        critBorderColor: '#93c5fd',
        critColor: '#4a9eff',
        todayLineColor: '#93c5fd',
        gridColor: '#64748b',
        tertiaryColor: '#2d2d2d',
        sequenceNumberColor: '#ffffff',
        signalColor: '#ffffff',
        actorBorder: '#ffffff',
        actorTextColor: '#ffffff',
        noteTextColor: '#ffffff',
        noteBorderColor: '#cbd5e1',
        activationTextColor: '#ffffff',
        edgeLabelBackground: '#0f172a',
        secondaryColor: '#2d2d2d',
        background: '#1a1a1a',
        mainBkg: '#0f0f0f',
        secondBkg: '#1a1a1a',
        tertiaryColor: '#2d2d2d'
      },
      themeCSS: `
        /* Ensure Gantt bars use unified blue tone inside SVG */
        .gantt .task rect,
        .gantt .task .task-bar,
        .gantt .task-bar rect { fill: #4a9eff; stroke: #93c5fd; }
        .gantt .task.active rect,
        .gantt .task.done rect,
        .gantt .task.crit rect { fill: #4a9eff; stroke: #93c5fd; }
        .gantt .today { stroke: #93c5fd; stroke-width: 1.5px; }
        .gantt .label text, .gantt text, .gantt .title text { fill: #ffffff; }
      `,
      gantt: {
        numberSectionStyles: 6,
        leftPadding: 200,
        gridLineStartPadding: 400,
        fontSize: 13,
        sectionFontSize: 15,
        fontFamily: '"Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif',
        barHeight: 22,
        barGap: 6,
        topPadding: 50,
        rightPadding: 150
      }
    });
  </script>
</head>
<body>
  <div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-title">SaaS Applications</div>
    <div class="sidebar-subtitle" id="tocCount">ÁõÆÊ¨°</div>
  </div>

  <div class="folder-tree" id="folderTree">
    <div class="tree-item">
      <div class="tree-label selected" data-toggle="root">
        <span class="tree-toggle expanded">‚ñº</span>
        <span class="tree-name">Á´†ÊßãÊàê</span>
        <span class="tree-count" id="sectionCount">--</span>
      </div>
      <div class="tree-children expanded" id="tocList">
        
      </div>
    </div>
  </div>

  <div class="sidebar-tags">
    <div class="tags-title">„ÇØ„Ç§„ÉÉ„ÇØ„É™„É≥„ÇØ</div>
    <div class="tag-list">
      <span class="tag" data-jump="#ui-flow">UIÈÅ∑Áßª</span>
      <span class="tag" data-jump="#ui">UI/ÁîªÈù¢</span>
      <span class="tag" data-jump="#functional">Ê©üËÉΩ</span>
      <span class="tag" data-jump="#nonfunctional">ÈùûÊ©üËÉΩ</span>
      <span class="tag" data-jump="#packaging">„Éë„ÉÉ„Ç±„Éº„Ç∏</span>
      <span class="tag" data-jump="#schedule">„Çπ„Ç±„Ç∏„É•„Éº„É´</span>
    </div>
  </div>

  <div class="sidebar-footer">
    <div class="sidebar-tags">
      <div class="tags-title">„ÉÜ„Éº„Éû</div>
      <div class="view-options">
        <button class="view-btn icon-btn active" id="themeDark">
          <span class="btn-icon">üåô</span>
          <span class="btn-label">„ÉÄ„Éº„ÇØ</span>
        </button>
        <button class="view-btn icon-btn" id="themeLight">
          <span class="btn-icon">‚òÄÔ∏è</span>
          <span class="btn-label">„É©„Ç§„Éà</span>
        </button>
      </div>
    </div>
  </div>
</div>

  
  <div class="main-content">
    <div class="header-bar">
  <button class="menu-btn icon-btn" id="toggleSidebar">
    <span class="btn-icon">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"/>
        <line x1="3" y1="12" x2="21" y2="12"/>
        <line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    </span>
  </button>
  
  <input type="text" class="search-bar" id="searchInput" placeholder="Ê§úÁ¥¢..." />
  
  <div class="view-options">
    <span class="theme-label">Ë°®Á§∫:</span>
    <button class="view-btn" id="viewCards">„Ç´„Éº„Éâ</button>
    <button class="view-btn active" id="viewList">„É™„Çπ„Éà</button>
  </div>
</div>

    
    <div class="doc-container" id="docContainer">
      
  
  
  
    
  
    
  
    
  
    
  
  
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
  

  
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  <script>window.SECTIONS = "[{\"category\":1,\"category_name\":\"„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ\",\"id\":\"saas-applications-overview\",\"title\":\"„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ\"},{\"category\":3,\"category_name\":\"„É°„Éá„Ç£„Ç¢„Ç®„Éá„Ç£„Çø\",\"id\":\"saas-ai-portrait\",\"title\":\"AI Portrait Generator\"},{\"category\":3,\"category_name\":\"„É°„Éá„Ç£„Ç¢„Ç®„Éá„Ç£„Çø\",\"id\":\"saas-storyboard\",\"title\":\"„Éì„Éá„Ç™„Éì„É•„Éº„Ç¢„Éº\"},{\"category\":3,\"category_name\":\"„É°„Éá„Ç£„Ç¢„Ç®„Éá„Ç£„Çø\",\"id\":\"saas-storyboard-viewer\",\"title\":\"„Çπ„Éà„Éº„É™„Éº„Éú„Éº„Éâ„Éì„É•„Éº„Ç¢„Éº\"},{\"category\":1,\"category_name\":\"„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥\",\"id\":\"saas-ai-portrait\",\"title\":\"AI Portrait Generator\"},{\"category\":3,\"category_name\":\"‰∫ãÊ•≠ÊßãÁØâ\",\"id\":\"biz-finance\",\"title\":\"Ë≤°Âãô\"},{\"category\":3,\"category_name\":\"‰∫ãÊ•≠ÊßãÁØâ\",\"id\":\"biz-strategy\",\"title\":\"Êà¶Áï•\"},{\"category\":5,\"category_name\":\"„Éó„É≠„É≥„Éó„ÉàÁΩÆ„ÅçÂ†¥\",\"id\":\"prompts-repo\",\"title\":\"„Éó„É≠„É≥„Éó„ÉàÁΩÆ„ÅçÂ†¥\"},{\"category\":2,\"category_name\":\"Ë¶Å‰ª∂ÂÆöÁæ©„ÉªÈñãÁô∫\",\"id\":\"requirements-document\",\"title\":\"Ë¶Å‰ª∂ÂÆöÁæ©Êõ∏\"},{\"category\":4,\"category_name\":\"„Éì„Ç∏„Éç„Çπ„ÉÑ„Éº„É´\",\"id\":\"slide-generator\",\"title\":\"„Çπ„É©„Ç§„Éâ„Ç®„Éá„Ç£„Çø\"},{\"category\":1,\"category_name\":\"„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥\",\"id\":\"saas-storyboard-viewer\",\"title\":\"„Çπ„Éà„Éº„É™„Éº„Éú„Éº„Éâ„Éì„É•„Éº„Ç¢„Éº\"},{\"category\":2,\"category_name\":\"Ë¶Å‰ª∂ÂÆöÁæ©„ÉªÈñãÁô∫\",\"id\":\"ui-views\",\"title\":\"UI„Éì„É•„Éº‰∏ÄË¶ß\"}]";</script>

  
  
  

  
  <section class="doc-section" id="saas-ai-portrait" data-cat="3" data-cat-name="„É°„Éá„Ç£„Ç¢„Ç®„Éá„Ç£„Çø">
    <h2>AI Portrait Generator</h2>

    

    

    

    

    

    

    

    

    

    

    
      <div style="margin-bottom: 20px;">
  <button onclick="window.location.hash=''; location.reload();" style="padding: 8px 16px; background: #4a4a4a; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 14px;">
    ‚Üê SaaS‰∏ÄË¶ß„Å´Êàª„Çã
  </button>
</div>
<style>
    .ai-portrait-interface {
        background: #1a1a1a;
        border-radius: 12px;
        padding: 0;
        margin: 20px 0;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }
    
    .app-container {
        display: flex;
        height: 600px;
        background: #1a1a1a;
        color: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    /* Left Sidebar - Reference Gallery */
    .reference-panel {
        width: 280px;
        background: #2d2d2d;
        padding: 20px;
        overflow-y: auto;
        border-right: 1px solid #3a3a3a;
    }
    
    .reference-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .reference-title {
        font-size: 22px;
        font-weight: bold;
        margin: 0;
        color: #ffffff;
    }
    
    .reload-btn {
        background: #3a3a3a;
        border: 1px solid #505050;
        border-radius: 6px;
        padding: 6px 10px;
        cursor: pointer;
        transition: all 0.2s;
        color: #e0e0e0;
        font-size: 16px;
    }
    
    .reload-btn:hover {
        background: #4a4a4a;
        border-color: #606060;
    }
    
    .reload-btn:active {
        transform: scale(0.95);
    }
    
    .reload-btn.loading .reload-icon {
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    /* Context menu styles */
    .context-menu {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        transition: opacity 0.2s;
    }
    
    .context-menu:hover {
        background: #3a3a3a !important;
    }
    
    .reference-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-bottom: 25px;
        max-height: 500px;
        overflow-y: auto;
    }
    
    .reference-item {
        position: relative;
        aspect-ratio: 1;
        border-radius: 6px;
        overflow: hidden;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.2s ease;
        background: #666;
    }
    
    .reference-item:hover {
        border-color: #4a9eff;
        transform: scale(1.02);
    }
    
    .reference-item.selected {
        border-color: #4a9eff;
        box-shadow: 0 0 15px rgba(74, 158, 255, 0.3);
    }
    
    .reference-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .reference-item .checkmark {
        position: absolute;
        bottom: 4px;
        right: 4px;
        width: 18px;
        height: 18px;
        background: #4a9eff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    
    .reference-item.selected .checkmark {
        opacity: 1;
    }
    
    
    /* Main Content Area */
    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #1a1a1a;
        position: relative;
    }
    
    /* Header */
    .app-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 30px;
        background: #2d2d2d;
        border-bottom: 1px solid #3a3a3a;
    }
    
    .header-title {
        font-size: 24px;
        font-weight: bold;
        color: #ffffff;
    }
    
    .header-controls {
        display: flex;
        gap: 12px;
        align-items: center;
    }
    
    .icon-button {
        width: 36px;
        height: 36px;
        border-radius: 6px;
        background: #3a3a3a;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ffffff;
        transition: all 0.2s ease;
    }
    
    .icon-button:hover {
        background: #4a4a4a;
        transform: translateY(-1px);
    }
    
    .notification-badge {
        position: relative;
    }
    
    .notification-badge::after {
        content: '1';
        position: absolute;
        top: -4px;
        right: -4px;
        width: 16px;
        height: 16px;
        background: #ff4757;
        border-radius: 50%;
        font-size: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }
    
    /* Before/After Comparison */
    .generation-area {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 30px;
    }
    
    .before-after-comparison {
        display: flex;
        align-items: center;
        gap: 40px;
    }
    
    
    .comparison-label {
        font-size: 18px;
        font-weight: bold;
        color: #ffffff;
        margin-bottom: 15px;
    }
    
    .comparison-image {
        width: 300px;
        height: 300px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        background: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }
    
    .before-item .comparison-image {
        background: #f0f0f0;
    }
    
    .after-item .comparison-image {
        background: #333;
    }
    
    .placeholder-sketch {
        color: #666;
        font-size: 16px;
        text-align: center;
    }
    
    .placeholder-result {
        color: #999;
        font-size: 16px;
        text-align: center;
    }
    
    .comparison-arrow {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 60px;
        height: 60px;
        background: #4a4a4a;
        border-radius: 50%;
    }
    
    .arrow-large {
        width: 0;
        height: 0;
        border-left: 15px solid #ffffff;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
    }
    
    /* Drawing and Controls */
    .drawing-controls {
        position: absolute;
        right: 20px;
        top: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .control-buttons {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .control-btn {
        padding: 8px 12px;
        border-radius: 6px;
        background: #3a3a3a;
        border: none;
        cursor: pointer;
        color: #ffffff;
        font-size: 12px;
        transition: all 0.2s ease;
        white-space: nowrap;
    }
    
    .control-btn:hover {
        background: #4a4a4a;
        transform: translateY(-1px);
    }
    
    .comparison-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
    }
    
    #drawingCanvas {
        display: none;
        border: 2px solid #4a9eff;
        border-radius: 12px;
    }
</style>

<div class="ai-portrait-interface">
    <div class="app-container">
        <!-- Left Sidebar - Reference Gallery -->
        <div class="reference-panel">
            <div class="reference-header">
                <h2 class="reference-title">Reference</h2>
                <button class="reload-btn" id="reloadImages" title="Reload Images">
                    <span class="reload-icon">üîÑ</span>
                </button>
            </div>
            <div class="reference-grid" id="referenceGrid">
                <!-- Images will be loaded dynamically -->
            </div>
            
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Header -->
            <div class="app-header">
                <h1 class="header-title">AI Generation</h1>
                <div class="header-controls">
                    <button class="icon-button">üîç</button>
                    <button class="icon-button">üíæ</button>
                    <button class="icon-button notification-badge">üõí</button>
                </div>
            </div>
            
            <!-- Before/After Comparison Area -->
            <div class="generation-area">
                <div class="before-after-comparison">
                    <div class="comparison-item before-item">
                        <div class="comparison-label">Before</div>
                        <div class="comparison-image" id="beforeImage">
                            <img src="/images/fighting-line-art.png" alt="Fighting line art" style="width:100%;height:100%;object-fit:cover;">
                            <canvas id="drawingCanvas" width="300" height="300" style="position: absolute; top: 0; left: 0; cursor: crosshair; z-index: 10; display: none; border-radius: 12px;"></canvas>
                        </div>
                    </div>
                    <div class="comparison-arrow">
                        <div class="arrow-large"></div>
                    </div>
                    <div class="comparison-item after-item">
                        <div class="comparison-label">After</div>
                        <div class="comparison-image" id="afterImage">
                            <video src="/images/Nzf983xJ3tjGM8FIECfL9_video.mp4" alt="Generated Fighting Scene" style="width:100%;height:100%;object-fit:cover;" autoplay loop muted>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Drawing and Controls -->
            <div class="drawing-controls">
                <div class="control-buttons">
                    <button class="control-btn" id="clearCanvas">üóëÔ∏è Clear</button>
                    <button class="control-btn" id="switchImages">‚áÑ Switch</button>
                    <button class="control-btn" id="toggleDraw">‚úèÔ∏è Draw</button>
                    <button class="control-btn" id="saveDrawing">üíæ Save</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        let allImages = []; // Will be populated from JSON file

        // Function to load images into reference grid
        function loadImages() {
            const referenceGrid = document.getElementById('referenceGrid');
            referenceGrid.innerHTML = ''; // Clear existing images
            
            allImages.forEach((imageName, index) => {
                const referenceItem = document.createElement('div');
                referenceItem.className = 'reference-item';
                
                // Select first few items by default for demo
                if (index % 3 === 0) {
                    referenceItem.classList.add('selected');
                }
                
                // Create readable alt text from filename
                const altText = imageName
                    .replace(/\.(png|jpg|jpeg|gif)$/i, '')
                    .replace(/[-_]/g, ' ')
                    .replace(/\b\w/g, char => char.toUpperCase());
                
                referenceItem.innerHTML = `
                    <img src="/images/${imageName}" alt="${altText}">
                    <div class="checkmark">‚úì</div>
                `;
                
                referenceGrid.appendChild(referenceItem);
            });
            
            // Re-attach click event listeners
            document.querySelectorAll('.reference-item').forEach(item => {
                // Left click - update Before image
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Toggle selection
                    this.classList.toggle('selected');
                    
                    // Update Before image
                    const img = this.querySelector('img');
                    if (img) {
                        const beforeImg = document.querySelector('#beforeImage img');
                        if (beforeImg) {
                            beforeImg.src = img.src;
                            beforeImg.alt = img.alt;
                        }
                    }
                });
                
                // Right click - show context menu with relative path
                item.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    
                    const img = this.querySelector('img');
                    if (img) {
                        // Get relative path from src
                        const src = img.src;
                        const relativePath = src.substring(src.indexOf('/images/'));
                        
                        // Remove existing context menu if any
                        const existingMenu = document.querySelector('.context-menu');
                        if (existingMenu) {
                            existingMenu.remove();
                        }
                        
                        // Create context menu
                        const menu = document.createElement('div');
                        menu.className = 'context-menu';
                        menu.style.cssText = `
                            position: fixed;
                            left: ${e.clientX}px;
                            top: ${e.clientY}px;
                            background: #2a2a2a;
                            border: 1px solid #444;
                            border-radius: 4px;
                            padding: 8px 12px;
                            color: #e0e0e0;
                            font-size: 12px;
                            z-index: 1000;
                            cursor: pointer;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                        `;
                        menu.textContent = relativePath;
                        menu.title = 'Click to copy';
                        
                        // Copy on click
                        menu.addEventListener('click', function() {
                            navigator.clipboard.writeText(relativePath).then(() => {
                                menu.textContent = '‚úÖ Copied!';
                                setTimeout(() => {
                                    menu.remove();
                                }, 1000);
                            }).catch(err => {
                                console.error('Failed to copy:', err);
                                menu.textContent = '‚ùå Copy failed';
                            });
                        });
                        
                        document.body.appendChild(menu);
                        
                        // Remove menu when clicking elsewhere
                        const removeMenu = (e) => {
                            if (!menu.contains(e.target)) {
                                menu.remove();
                                document.removeEventListener('click', removeMenu);
                            }
                        };
                        setTimeout(() => {
                            document.addEventListener('click', removeMenu);
                        }, 0);
                    }
                });
            });
        }
        
        // Function to fetch images list from JSON
        async function fetchImagesList(fromApi = false) {
            try {
                // If fromApi is true, fetch from API endpoint which also updates the JSON
                const url = fromApi ? '/api/images' : '/data/images_list.json';
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Failed to fetch images list');
                }
                const data = await response.json();
                allImages = data.images || [];
                loadImages();
            } catch (error) {
                console.error('Error fetching images:', error);
                // Fallback: try to load from static JSON if API fails
                if (fromApi) {
                    fetchImagesList(false);
                } else {
                    allImages = [];
                    loadImages();
                }
            }
        }
        
        // Initial load
        fetchImagesList();
        
        // Reload button functionality
        document.getElementById('reloadImages').addEventListener('click', async function() {
            const btn = this;
            btn.classList.add('loading');
            
            // Re-fetch images list from API (which updates the JSON file)
            try {
                await fetchImagesList(true); // true = use API endpoint
                btn.classList.remove('loading');
                
                // Show success feedback
                const originalText = btn.querySelector('.reload-icon').textContent;
                btn.querySelector('.reload-icon').textContent = '‚úÖ';
                setTimeout(() => {
                    btn.querySelector('.reload-icon').textContent = originalText;
                }, 1000);
            } catch (error) {
                btn.classList.remove('loading');
                console.error('Error reloading images:', error);
                
                // Show error feedback
                const originalText = btn.querySelector('.reload-icon').textContent;
                btn.querySelector('.reload-icon').textContent = '‚ùå';
                setTimeout(() => {
                    btn.querySelector('.reload-icon').textContent = originalText;
                }, 1000);
            }
        });


        // Drawing functionality
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let drawingEnabled = false;
        let lastSavedDrawing = null;

        // Set drawing style
        ctx.strokeStyle = '#ff0000';
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';

        // Toggle drawing mode
        document.getElementById('toggleDraw').addEventListener('click', function() {
            drawingEnabled = !drawingEnabled;
            canvas.style.display = drawingEnabled ? 'block' : 'none';
            this.textContent = drawingEnabled ? 'üñäÔ∏è Drawing' : '‚úèÔ∏è Draw';
            this.style.background = drawingEnabled ? '#4a9eff' : '#3a3a3a';
        });

        // Clear canvas
        document.getElementById('clearCanvas').addEventListener('click', function() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        // Switch images
        document.getElementById('switchImages').addEventListener('click', function() {
            const beforeImg = document.querySelector('#beforeImage img');
            const afterImg = document.querySelector('#afterImage img');
            const tempSrc = beforeImg.src;
            const tempAlt = beforeImg.alt;
            
            beforeImg.src = afterImg.src;
            beforeImg.alt = afterImg.alt;
            afterImg.src = tempSrc;
            afterImg.alt = tempAlt;
        });

        // Save drawing combined with background image
        document.getElementById('saveDrawing').addEventListener('click', function() {
            const beforeImg = document.querySelector('#beforeImage img');
            const canvas = document.getElementById('drawingCanvas');
            
            // Create a new canvas to combine image and drawing
            const combinedCanvas = document.createElement('canvas');
            const combinedCtx = combinedCanvas.getContext('2d');
            
            // Set canvas size to match the image display size
            combinedCanvas.width = 300;
            combinedCanvas.height = 300;
            
            // Create a new image to ensure it's loaded
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                // Draw the background image
                combinedCtx.drawImage(img, 0, 0, 300, 300);
                
                // Draw the drawing on top
                combinedCtx.drawImage(canvas, 0, 0);
                
                // Convert to base64 data URL
                const dataURL = combinedCanvas.toDataURL('image/png');
                const timestamp = Date.now();
                const filename = 'hand-drawn-' + timestamp + '.png';
                
                // Add to reference gallery immediately
                const referenceGrid = document.querySelector('.reference-grid');
                const newReferenceItem = document.createElement('div');
                newReferenceItem.className = 'reference-item selected';
                newReferenceItem.innerHTML = `
                    <img src="${dataURL}" alt="Hand Drawn">
                    <div class="checkmark">‚úì</div>
                `;
                
                // Add click functionality - same as other reference items
                // Left click - update Before image
                newReferenceItem.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Toggle selection
                    this.classList.toggle('selected');
                    
                    // Update Before image
                    const img = this.querySelector('img');
                    if (img) {
                        const beforeImg = document.querySelector('#beforeImage img');
                        if (beforeImg) {
                            beforeImg.src = img.src;
                            beforeImg.alt = img.alt;
                        }
                    }
                });
                
                // Right click - show context menu
                newReferenceItem.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    
                    const img = this.querySelector('img');
                    if (img) {
                        // For saved drawings, use the filename
                        const relativePath = '/' + filename;
                        
                        // Remove existing context menu if any
                        const existingMenu = document.querySelector('.context-menu');
                        if (existingMenu) {
                            existingMenu.remove();
                        }
                        
                        // Create context menu
                        const menu = document.createElement('div');
                        menu.className = 'context-menu';
                        menu.style.cssText = `
                            position: fixed;
                            left: ${e.clientX}px;
                            top: ${e.clientY}px;
                            background: #2a2a2a;
                            border: 1px solid #444;
                            border-radius: 4px;
                            padding: 8px 12px;
                            color: #e0e0e0;
                            font-size: 12px;
                            z-index: 1000;
                            cursor: pointer;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                        `;
                        menu.textContent = relativePath;
                        menu.title = 'Click to copy';
                        
                        // Copy on click
                        menu.addEventListener('click', function() {
                            navigator.clipboard.writeText(relativePath).then(() => {
                                menu.textContent = '‚úÖ Copied!';
                                setTimeout(() => {
                                    menu.remove();
                                }, 1000);
                            }).catch(err => {
                                console.error('Failed to copy:', err);
                                menu.textContent = '‚ùå Copy failed';
                            });
                        });
                        
                        document.body.appendChild(menu);
                        
                        // Remove menu when clicking elsewhere
                        const removeMenu = (e) => {
                            if (!menu.contains(e.target)) {
                                menu.remove();
                                document.removeEventListener('click', removeMenu);
                            }
                        };
                        setTimeout(() => {
                            document.addEventListener('click', removeMenu);
                        }, 0);
                    }
                });
                
                referenceGrid.appendChild(newReferenceItem);
                
                // Store the last saved drawing for AI generation
                lastSavedDrawing = dataURL;
                
                // Also download the file
                combinedCanvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 'image/png');
                
                // Show success message
                const saveBtn = document.getElementById('saveDrawing');
                const originalText = saveBtn.textContent;
                saveBtn.textContent = '‚úÖ Saved & Added!';
                saveBtn.style.background = '#4CAF50';
                setTimeout(() => {
                    saveBtn.textContent = originalText;
                    saveBtn.style.background = '#3a3a3a';
                }, 2000);
            };
            
            img.src = beforeImg.src;
        });


        // Drawing events
        canvas.addEventListener('mousedown', function(e) {
            if (!drawingEnabled) return;
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        });

        canvas.addEventListener('mousemove', function(e) {
            if (!drawingEnabled || !isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        });

        canvas.addEventListener('mouseup', function() {
            isDrawing = false;
        });

        canvas.addEventListener('mouseout', function() {
            isDrawing = false;
        });
    });
</script>

    

    

    

    

    

    

    
  </section>
  
  <section class="doc-section" id="saas-ai-portrait" data-cat="1" data-cat-name="„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥">
    <h2>AI Portrait Generator</h2>

    

    

    

    

    

    

    

    

    

    

    
      <div style="margin-bottom: 20px;">
  <button onclick="window.location.hash=''; location.reload();" style="padding: 8px 16px; background: #4a4a4a; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 14px;">
    ‚Üê SaaS‰∏ÄË¶ß„Å´Êàª„Çã
  </button>
</div>
<style>
    .ai-portrait-interface {
        background: #1a1a1a;
        border-radius: 12px;
        padding: 0;
        margin: 20px 0;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }
    
    .app-container {
        display: flex;
        height: 600px;
        background: #1a1a1a;
        color: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    /* Left Sidebar - Reference Gallery */
    .reference-panel {
        width: 280px;
        background: #2d2d2d;
        padding: 20px;
        overflow-y: auto;
        border-right: 1px solid #3a3a3a;
    }
    
    .reference-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .reference-title {
        font-size: 22px;
        font-weight: bold;
        margin: 0;
        color: #ffffff;
    }
    
    .reload-btn {
        background: #3a3a3a;
        border: 1px solid #505050;
        border-radius: 6px;
        padding: 6px 10px;
        cursor: pointer;
        transition: all 0.2s;
        color: #e0e0e0;
        font-size: 16px;
    }
    
    .reload-btn:hover {
        background: #4a4a4a;
        border-color: #606060;
    }
    
    .reload-btn:active {
        transform: scale(0.95);
    }
    
    .reload-btn.loading .reload-icon {
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    /* Context menu styles */
    .context-menu {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        transition: opacity 0.2s;
    }
    
    .context-menu:hover {
        background: #3a3a3a !important;
    }
    
    .reference-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-bottom: 25px;
        max-height: 500px;
        overflow-y: auto;
    }
    
    .reference-item {
        position: relative;
        aspect-ratio: 1;
        border-radius: 6px;
        overflow: hidden;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.2s ease;
        background: #666;
    }
    
    .reference-item:hover {
        border-color: #4a9eff;
        transform: scale(1.02);
    }
    
    .reference-item.selected {
        border-color: #4a9eff;
        box-shadow: 0 0 15px rgba(74, 158, 255, 0.3);
    }
    
    .reference-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .reference-item .checkmark {
        position: absolute;
        bottom: 4px;
        right: 4px;
        width: 18px;
        height: 18px;
        background: #4a9eff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    
    .reference-item.selected .checkmark {
        opacity: 1;
    }
    
    
    /* Main Content Area */
    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #1a1a1a;
        position: relative;
    }
    
    /* Header */
    .app-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 30px;
        background: #2d2d2d;
        border-bottom: 1px solid #3a3a3a;
    }
    
    .header-title {
        font-size: 24px;
        font-weight: bold;
        color: #ffffff;
    }
    
    .header-controls {
        display: flex;
        gap: 12px;
        align-items: center;
    }
    
    .icon-button {
        width: 36px;
        height: 36px;
        border-radius: 6px;
        background: #3a3a3a;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ffffff;
        transition: all 0.2s ease;
    }
    
    .icon-button:hover {
        background: #4a4a4a;
        transform: translateY(-1px);
    }
    
    .notification-badge {
        position: relative;
    }
    
    .notification-badge::after {
        content: '1';
        position: absolute;
        top: -4px;
        right: -4px;
        width: 16px;
        height: 16px;
        background: #ff4757;
        border-radius: 50%;
        font-size: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }
    
    /* Before/After Comparison */
    .generation-area {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 30px;
    }
    
    .before-after-comparison {
        display: flex;
        align-items: center;
        gap: 40px;
    }
    
    
    .comparison-label {
        font-size: 18px;
        font-weight: bold;
        color: #ffffff;
        margin-bottom: 15px;
    }
    
    .comparison-image {
        width: 300px;
        height: 300px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        background: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }
    
    .before-item .comparison-image {
        background: #f0f0f0;
    }
    
    .after-item .comparison-image {
        background: #333;
    }
    
    .placeholder-sketch {
        color: #666;
        font-size: 16px;
        text-align: center;
    }
    
    .placeholder-result {
        color: #999;
        font-size: 16px;
        text-align: center;
    }
    
    .comparison-arrow {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 60px;
        height: 60px;
        background: #4a4a4a;
        border-radius: 50%;
    }
    
    .arrow-large {
        width: 0;
        height: 0;
        border-left: 15px solid #ffffff;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
    }
    
    /* Drawing and Controls */
    .drawing-controls {
        position: absolute;
        right: 20px;
        top: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .control-buttons {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .control-btn {
        padding: 8px 12px;
        border-radius: 6px;
        background: #3a3a3a;
        border: none;
        cursor: pointer;
        color: #ffffff;
        font-size: 12px;
        transition: all 0.2s ease;
        white-space: nowrap;
    }
    
    .control-btn:hover {
        background: #4a4a4a;
        transform: translateY(-1px);
    }
    
    .comparison-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
    }
    
    #drawingCanvas {
        display: none;
        border: 2px solid #4a9eff;
        border-radius: 12px;
    }
</style>

<div class="ai-portrait-interface">
    <div class="app-container">
        <!-- Left Sidebar - Reference Gallery -->
        <div class="reference-panel">
            <div class="reference-header">
                <h2 class="reference-title">Reference</h2>
                <button class="reload-btn" id="reloadImages" title="Reload Images">
                    <span class="reload-icon">üîÑ</span>
                </button>
            </div>
            <div class="reference-grid" id="referenceGrid">
                <!-- Images will be loaded dynamically -->
            </div>
            
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Header -->
            <div class="app-header">
                <h1 class="header-title">AI Generation</h1>
                <div class="header-controls">
                    <button class="icon-button">üîç</button>
                    <button class="icon-button">üíæ</button>
                    <button class="icon-button notification-badge">üõí</button>
                </div>
            </div>
            
            <!-- Before/After Comparison Area -->
            <div class="generation-area">
                <div class="before-after-comparison">
                    <div class="comparison-item before-item">
                        <div class="comparison-label">Before</div>
                        <div class="comparison-image" id="beforeImage">
                            <img src="/images/fighting-line-art.png" alt="Fighting line art" style="width:100%;height:100%;object-fit:cover;">
                            <canvas id="drawingCanvas" width="300" height="300" style="position: absolute; top: 0; left: 0; cursor: crosshair; z-index: 10; display: none; border-radius: 12px;"></canvas>
                        </div>
                    </div>
                    <div class="comparison-arrow">
                        <div class="arrow-large"></div>
                    </div>
                    <div class="comparison-item after-item">
                        <div class="comparison-label">After</div>
                        <div class="comparison-image" id="afterImage">
                            <video src="/images/Nzf983xJ3tjGM8FIECfL9_video.mp4" alt="Generated Fighting Scene" style="width:100%;height:100%;object-fit:cover;" autoplay loop muted>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Drawing and Controls -->
            <div class="drawing-controls">
                <div class="control-buttons">
                    <button class="control-btn" id="clearCanvas">üóëÔ∏è Clear</button>
                    <button class="control-btn" id="switchImages">‚áÑ Switch</button>
                    <button class="control-btn" id="toggleDraw">‚úèÔ∏è Draw</button>
                    <button class="control-btn" id="saveDrawing">üíæ Save</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        let allImages = []; // Will be populated from JSON file

        // Function to load images into reference grid
        function loadImages() {
            const referenceGrid = document.getElementById('referenceGrid');
            referenceGrid.innerHTML = ''; // Clear existing images
            
            allImages.forEach((imageName, index) => {
                const referenceItem = document.createElement('div');
                referenceItem.className = 'reference-item';
                
                // Select first few items by default for demo
                if (index % 3 === 0) {
                    referenceItem.classList.add('selected');
                }
                
                // Create readable alt text from filename
                const altText = imageName
                    .replace(/\.(png|jpg|jpeg|gif)$/i, '')
                    .replace(/[-_]/g, ' ')
                    .replace(/\b\w/g, char => char.toUpperCase());
                
                referenceItem.innerHTML = `
                    <img src="/images/${imageName}" alt="${altText}">
                    <div class="checkmark">‚úì</div>
                `;
                
                referenceGrid.appendChild(referenceItem);
            });
            
            // Re-attach click event listeners
            document.querySelectorAll('.reference-item').forEach(item => {
                // Left click - update Before image
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Toggle selection
                    this.classList.toggle('selected');
                    
                    // Update Before image
                    const img = this.querySelector('img');
                    if (img) {
                        const beforeImg = document.querySelector('#beforeImage img');
                        if (beforeImg) {
                            beforeImg.src = img.src;
                            beforeImg.alt = img.alt;
                        }
                    }
                });
                
                // Right click - show context menu with relative path
                item.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    
                    const img = this.querySelector('img');
                    if (img) {
                        // Get relative path from src
                        const src = img.src;
                        const relativePath = src.substring(src.indexOf('/images/'));
                        
                        // Remove existing context menu if any
                        const existingMenu = document.querySelector('.context-menu');
                        if (existingMenu) {
                            existingMenu.remove();
                        }
                        
                        // Create context menu
                        const menu = document.createElement('div');
                        menu.className = 'context-menu';
                        menu.style.cssText = `
                            position: fixed;
                            left: ${e.clientX}px;
                            top: ${e.clientY}px;
                            background: #2a2a2a;
                            border: 1px solid #444;
                            border-radius: 4px;
                            padding: 8px 12px;
                            color: #e0e0e0;
                            font-size: 12px;
                            z-index: 1000;
                            cursor: pointer;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                        `;
                        menu.textContent = relativePath;
                        menu.title = 'Click to copy';
                        
                        // Copy on click
                        menu.addEventListener('click', function() {
                            navigator.clipboard.writeText(relativePath).then(() => {
                                menu.textContent = '‚úÖ Copied!';
                                setTimeout(() => {
                                    menu.remove();
                                }, 1000);
                            }).catch(err => {
                                console.error('Failed to copy:', err);
                                menu.textContent = '‚ùå Copy failed';
                            });
                        });
                        
                        document.body.appendChild(menu);
                        
                        // Remove menu when clicking elsewhere
                        const removeMenu = (e) => {
                            if (!menu.contains(e.target)) {
                                menu.remove();
                                document.removeEventListener('click', removeMenu);
                            }
                        };
                        setTimeout(() => {
                            document.addEventListener('click', removeMenu);
                        }, 0);
                    }
                });
            });
        }
        
        // Function to fetch images list from JSON
        async function fetchImagesList(fromApi = false) {
            try {
                // If fromApi is true, fetch from API endpoint which also updates the JSON
                const url = fromApi ? '/api/images' : '/data/images_list.json';
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Failed to fetch images list');
                }
                const data = await response.json();
                allImages = data.images || [];
                loadImages();
            } catch (error) {
                console.error('Error fetching images:', error);
                // Fallback: try to load from static JSON if API fails
                if (fromApi) {
                    fetchImagesList(false);
                } else {
                    allImages = [];
                    loadImages();
                }
            }
        }
        
        // Initial load
        fetchImagesList();
        
        // Reload button functionality
        document.getElementById('reloadImages').addEventListener('click', async function() {
            const btn = this;
            btn.classList.add('loading');
            
            // Re-fetch images list from API (which updates the JSON file)
            try {
                await fetchImagesList(true); // true = use API endpoint
                btn.classList.remove('loading');
                
                // Show success feedback
                const originalText = btn.querySelector('.reload-icon').textContent;
                btn.querySelector('.reload-icon').textContent = '‚úÖ';
                setTimeout(() => {
                    btn.querySelector('.reload-icon').textContent = originalText;
                }, 1000);
            } catch (error) {
                btn.classList.remove('loading');
                console.error('Error reloading images:', error);
                
                // Show error feedback
                const originalText = btn.querySelector('.reload-icon').textContent;
                btn.querySelector('.reload-icon').textContent = '‚ùå';
                setTimeout(() => {
                    btn.querySelector('.reload-icon').textContent = originalText;
                }, 1000);
            }
        });


        // Drawing functionality
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let drawingEnabled = false;
        let lastSavedDrawing = null;

        // Set drawing style
        ctx.strokeStyle = '#ff0000';
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';

        // Toggle drawing mode
        document.getElementById('toggleDraw').addEventListener('click', function() {
            drawingEnabled = !drawingEnabled;
            canvas.style.display = drawingEnabled ? 'block' : 'none';
            this.textContent = drawingEnabled ? 'üñäÔ∏è Drawing' : '‚úèÔ∏è Draw';
            this.style.background = drawingEnabled ? '#4a9eff' : '#3a3a3a';
        });

        // Clear canvas
        document.getElementById('clearCanvas').addEventListener('click', function() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        // Switch images
        document.getElementById('switchImages').addEventListener('click', function() {
            const beforeImg = document.querySelector('#beforeImage img');
            const afterImg = document.querySelector('#afterImage img');
            const tempSrc = beforeImg.src;
            const tempAlt = beforeImg.alt;
            
            beforeImg.src = afterImg.src;
            beforeImg.alt = afterImg.alt;
            afterImg.src = tempSrc;
            afterImg.alt = tempAlt;
        });

        // Save drawing combined with background image
        document.getElementById('saveDrawing').addEventListener('click', function() {
            const beforeImg = document.querySelector('#beforeImage img');
            const canvas = document.getElementById('drawingCanvas');
            
            // Create a new canvas to combine image and drawing
            const combinedCanvas = document.createElement('canvas');
            const combinedCtx = combinedCanvas.getContext('2d');
            
            // Set canvas size to match the image display size
            combinedCanvas.width = 300;
            combinedCanvas.height = 300;
            
            // Create a new image to ensure it's loaded
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                // Draw the background image
                combinedCtx.drawImage(img, 0, 0, 300, 300);
                
                // Draw the drawing on top
                combinedCtx.drawImage(canvas, 0, 0);
                
                // Convert to base64 data URL
                const dataURL = combinedCanvas.toDataURL('image/png');
                const timestamp = Date.now();
                const filename = 'hand-drawn-' + timestamp + '.png';
                
                // Add to reference gallery immediately
                const referenceGrid = document.querySelector('.reference-grid');
                const newReferenceItem = document.createElement('div');
                newReferenceItem.className = 'reference-item selected';
                newReferenceItem.innerHTML = `
                    <img src="${dataURL}" alt="Hand Drawn">
                    <div class="checkmark">‚úì</div>
                `;
                
                // Add click functionality - same as other reference items
                // Left click - update Before image
                newReferenceItem.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Toggle selection
                    this.classList.toggle('selected');
                    
                    // Update Before image
                    const img = this.querySelector('img');
                    if (img) {
                        const beforeImg = document.querySelector('#beforeImage img');
                        if (beforeImg) {
                            beforeImg.src = img.src;
                            beforeImg.alt = img.alt;
                        }
                    }
                });
                
                // Right click - show context menu
                newReferenceItem.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    
                    const img = this.querySelector('img');
                    if (img) {
                        // For saved drawings, use the filename
                        const relativePath = '/' + filename;
                        
                        // Remove existing context menu if any
                        const existingMenu = document.querySelector('.context-menu');
                        if (existingMenu) {
                            existingMenu.remove();
                        }
                        
                        // Create context menu
                        const menu = document.createElement('div');
                        menu.className = 'context-menu';
                        menu.style.cssText = `
                            position: fixed;
                            left: ${e.clientX}px;
                            top: ${e.clientY}px;
                            background: #2a2a2a;
                            border: 1px solid #444;
                            border-radius: 4px;
                            padding: 8px 12px;
                            color: #e0e0e0;
                            font-size: 12px;
                            z-index: 1000;
                            cursor: pointer;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                        `;
                        menu.textContent = relativePath;
                        menu.title = 'Click to copy';
                        
                        // Copy on click
                        menu.addEventListener('click', function() {
                            navigator.clipboard.writeText(relativePath).then(() => {
                                menu.textContent = '‚úÖ Copied!';
                                setTimeout(() => {
                                    menu.remove();
                                }, 1000);
                            }).catch(err => {
                                console.error('Failed to copy:', err);
                                menu.textContent = '‚ùå Copy failed';
                            });
                        });
                        
                        document.body.appendChild(menu);
                        
                        // Remove menu when clicking elsewhere
                        const removeMenu = (e) => {
                            if (!menu.contains(e.target)) {
                                menu.remove();
                                document.removeEventListener('click', removeMenu);
                            }
                        };
                        setTimeout(() => {
                            document.addEventListener('click', removeMenu);
                        }, 0);
                    }
                });
                
                referenceGrid.appendChild(newReferenceItem);
                
                // Store the last saved drawing for AI generation
                lastSavedDrawing = dataURL;
                
                // Also download the file
                combinedCanvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 'image/png');
                
                // Show success message
                const saveBtn = document.getElementById('saveDrawing');
                const originalText = saveBtn.textContent;
                saveBtn.textContent = '‚úÖ Saved & Added!';
                saveBtn.style.background = '#4CAF50';
                setTimeout(() => {
                    saveBtn.textContent = originalText;
                    saveBtn.style.background = '#3a3a3a';
                }, 2000);
            };
            
            img.src = beforeImg.src;
        });


        // Drawing events
        canvas.addEventListener('mousedown', function(e) {
            if (!drawingEnabled) return;
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        });

        canvas.addEventListener('mousemove', function(e) {
            if (!drawingEnabled || !isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        });

        canvas.addEventListener('mouseup', function() {
            isDrawing = false;
        });

        canvas.addEventListener('mouseout', function() {
            isDrawing = false;
        });
    });
</script>

    

    

    

    

    

    

    
  </section>
  

    </div>
  </div>
  
  
<div class="modal-backdrop" id="jsonModal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title" id="jsonModalTitle">JSON„Éó„É¨„Éì„É•„Éº</span>
    </div>
    <div class="modal-body">
      <pre class="code" id="jsonContent"></pre>
    </div>
    <div class="modal-actions">
      <button class="view-btn" id="jsonCopyBtn">„Ç≥„Éî„Éº</button>
      <button class="view-btn" id="jsonCloseBtn">Èñâ„Åò„Çã</button>
    </div>
  </div>
</div>


<div class="modal-backdrop" id="imgModal">
  <div class="modal" style="max-width:90%; width:auto;">
    <div class="modal-header">
      <span class="modal-title" id="imgModalTitle">ÁîªÂÉè„Éó„É¨„Éì„É•„Éº</span>
    </div>
    <div class="modal-body" style="padding:0; background:var(--media-bg);">
      <img id="imgModalImage" src="" alt="" style="width:100%; height:auto; display:block;">
    </div>
    <div class="modal-actions">
      <button class="view-btn" id="imgCloseBtn">Èñâ„Åò„Çã</button>
    </div>
  </div>
</div>

  <div class="sidebar-backdrop" id="sidebarBackdrop"></div>
  
  <script src="/js/main.js"></script>
</body>
</html>
